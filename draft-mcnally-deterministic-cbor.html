<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>dCBOR: Deterministic CBOR</title>
<meta content="Wolf McNally" name="author">
<meta content="Christopher Allen" name="author">
<meta content="Carsten Bormann" name="author">
<meta content="Laurence Lundblade" name="author">
<meta content='
       The purpose of determinism is to ensure that semantically equivalent data items are encoded into identical byte streams. CBOR (RFC 8949) defines "Deterministically Encoded CBOR" in its Section 4.2, but leaves some important choices up to the application developer. The present document specifies dCBOR, a set of narrowing rules for CBOR that can be used to help achieve interoperable deterministic encoding for a variety of applications desiring a narrow and clearly defined set of choices. 
    ' name="description">
<meta content="xml2rfc 3.17.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-mcnally-deterministic-cbor-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.17.1
    Python 3.10.13
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.2
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.2
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.28.2
    setuptools 67.6.1
    six 1.16.0
    wcwidth 0.2.6
-->
<link href="draft-mcnally-deterministic-cbor.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 8em !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">dCBOR</td>
<td class="right">October 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">McNally, et al.</td>
<td class="center">Expires 4 May 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-mcnally-deterministic-cbor-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-10-31" class="published">31 October 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-05-04">4 May 2026</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">W. McNally</div>
<div class="org">Blockchain Commons</div>
</div>
<div class="author">
      <div class="author-name">C. Allen</div>
<div class="org">Blockchain Commons</div>
</div>
<div class="author">
      <div class="author-name">C. Bormann</div>
<div class="org">Universität Bremen TZI</div>
</div>
<div class="author">
      <div class="author-name">L. Lundblade</div>
<div class="org">Security Theory LLC</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">dCBOR: Deterministic CBOR</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The purpose of determinism is to ensure that semantically equivalent data items are encoded into identical byte streams. CBOR (RFC 8949) defines "Deterministically Encoded CBOR" in its Section 4.2, but leaves some important choices up to the application developer. The present document specifies dCBOR, a set of narrowing rules for CBOR that can be used to help achieve interoperable deterministic encoding for a variety of applications desiring a narrow and clearly defined set of choices.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-mcnally-deterministic-cbor/">https://datatracker.ietf.org/doc/draft-mcnally-deterministic-cbor/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/BlockchainCommons/WIPs-IETF-draft-deterministic-cbor">https://github.com/BlockchainCommons/WIPs-IETF-draft-deterministic-cbor</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 4 May 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-narrowing-rules" class="internal xref">Narrowing Rules</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-definite-length-items" class="internal xref">Definite Length Items</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-preferred-serialization" class="internal xref">Preferred Serialization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-ordered-map-keys" class="internal xref">Ordered Map Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-duplicate-map-keys" class="internal xref">Duplicate Map Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="auto internal xref">2.5</a>.  <a href="#name-numeric-reduction" class="internal xref">Numeric Reduction</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="auto internal xref">2.6</a>.  <a href="#name-simple-values" class="internal xref">Simple Values</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.7">
                <p id="section-toc.1-1.2.2.7.1"><a href="#section-2.7" class="auto internal xref">2.7</a>.  <a href="#name-strings" class="internal xref">Strings</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-cddl-support-declarative-ta" class="internal xref">CDDL support, Declarative Tag</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-implementation-status" class="internal xref">Implementation Status</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-swift" class="internal xref">Swift</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-rust" class="internal xref">Rust</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-typescript" class="internal xref">TypeScript</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-ruby" class="internal xref">Ruby</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-appendix-a-dcbor-numeric-te" class="internal xref">Appendix A: dCBOR Numeric Test Vectors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-dcbor-numeric-encodings" class="internal xref">dCBOR Numeric Encodings</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-invalid-dcbor-encodings" class="internal xref">Invalid dCBOR Encodings</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-appendix-b-design-principle" class="internal xref">Appendix B: Design Principles</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-why-numeric-reduction" class="internal xref">Why Numeric Reduction?</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-why-not-undefined" class="internal xref">Why Not <code>undefined</code>?</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-why-only-a-single-nan" class="internal xref">Why only a single <code>NaN</code>?</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-why-not-other-simple-values" class="internal xref">Why not other simple values?</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="auto internal xref">8.5</a>.  <a href="#name-limiting-principles" class="internal xref">Limiting Principles</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="auto internal xref">8.6</a>.  <a href="#name-why-not-define-an-api" class="internal xref">Why not define an API?</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-acknowledgments" class="internal xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> has many advantages over other data serialization formats. One of its strengths is specifications and guidelines for serializing data deterministically, such that multiple agents serializing the same data automatically achieve consensus on the exact byte-level form of that serialized data. This is particularly useful when data must be compared for semantic equivalence by comparing the hash of its contents.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Nonetheless, determinism is an opt-in feature of CBOR, and most existing CBOR codecs put the primary burden of correct deterministic serialization and validation of deterministic encoding during deserialization on the engineer. Furthermore, the specification leaves a number of important decisions around determinism up to the application developer.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document narrows CBOR to a set of requirements called "dCBOR". These requirements include choices left open in CBOR, but also go beyond, including requiring that dCBOR decoders validate that encoded CBOR conforms to the requirements of this document.<a href="#section-1-3" class="pilcrow">¶</a></p>
<div id="conventions-and-definitions">
<section id="section-1.1">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-1.1-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="narrowing-rules">
<section id="section-2">
      <h2 id="name-narrowing-rules">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-narrowing-rules" class="section-name selfRef">Narrowing Rules</a>
      </h2>
<p id="section-2-1">This section specifies the exclusions and reductions that dCBOR applies to CBOR.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The rules specified here do not "fork" CBOR: A dCBOR implementation produces well-formed, deterministically encoded CBOR according to <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>, and existing CBOR decoders will therefore be able to decode it. Similarly, CBOR encoders will be able to produce valid dCBOR if handed dCBOR-conforming data model level information from an application.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">Note that the separation between standard CBOR processing and the processing required by the dCBOR rules is a conceptual one: Both dCBOR processing and standard CBOR processing may be combined into a unified dCBOR/CBOR codec. The requirements in this document apply to encoding or decoding of dCBOR data, regardless of whether the codec is a unified dCBOR/CBOR codec operating in dCBOR-compliant modes, or a single-purpose dCBOR codec. Both of these are generically referred to as "dCBOR codecs" in this document.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">dCBOR is intended to be used in conjunction with an application, which typically will use a subset of CBOR, which in turn influences which subset of dCBOR that is used. As a result, dCBOR places no direct requirement on what subset of CBOR is implemented. For instance, there is no requirement that dCBOR implementations support floating point numbers (or any other kind of non-basic integer type, such as arbitrary precision integers or complex numbers) when they are used with applications that do not use them. However, this document does place requirements on dCBOR implementations that support negative 64-bit integers and 64-bit or smaller floating point numbers.<a href="#section-2-4" class="pilcrow">¶</a></p>
<div id="definite-length-items">
<section id="section-2.1">
        <h3 id="name-definite-length-items">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-definite-length-items" class="section-name selfRef">Definite Length Items</a>
        </h3>
<p id="section-2.1-1">CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> allows both "definite-length" and "indefinite-length" items for byte strings, text strings, arrays, and maps (§3.2).<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">dCBOR encoders:<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.1-3">
<li id="section-2.1-3.1">
            <span class="bcp14">MUST</span> only emit "definite-length" items for byte strings, text strings, arrays, and maps.<a href="#section-2.1-3.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.1-4">dCBOR decoders:<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<ol start="2" type="1" class="normal type-1" id="section-2.1-5">
<li id="section-2.1-5.1">
            <span class="bcp14">MUST</span> reject any encoded "indefinite-length" items for byte strings, text strings, arrays, and maps.<a href="#section-2.1-5.1" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
<div id="preferred-serialization">
<section id="section-2.2">
        <h3 id="name-preferred-serialization">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-preferred-serialization" class="section-name selfRef">Preferred Serialization</a>
        </h3>
<p id="section-2.2-1">CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> allows multiple possible encodings for the same data item, and defines a "preferred serialization" in §4.1 to be used for deterministic encoding.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">dCBOR encoders:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.2-3">
<li id="section-2.2-3.1">
            <span class="bcp14">MUST</span> only emit "preferred serialization".<a href="#section-2.2-3.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.2-4">dCBOR decoders:<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<ol start="2" type="1" class="normal type-1" id="section-2.2-5">
<li id="section-2.2-5.1">
            <span class="bcp14">MUST</span> validate that encoded CBOR conforms to "preferred serialization", and reject any encoded CBOR that does not conform.<a href="#section-2.2-5.1" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
<div id="ordered-map-keys">
<section id="section-2.3">
        <h3 id="name-ordered-map-keys">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-ordered-map-keys" class="section-name selfRef">Ordered Map Keys</a>
        </h3>
<p id="section-2.3-1">The last bullet item of CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> §4.2.1 defines a "bytewise lexicographic order" for map keys to be used for deterministic encoding.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">dCBOR encoders:<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.3-3">
<li id="section-2.3-3.1">
            <span class="bcp14">MUST</span> only emit CBOR maps with keys in "bytewise lexicographic order".<a href="#section-2.3-3.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.3-4">dCBOR decoders:<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<ol start="2" type="1" class="normal type-1" id="section-2.3-5">
<li id="section-2.3-5.1">
            <span class="bcp14">MUST</span> validate that encoded CBOR maps have keys in "bytewise lexicographic order", and reject any encoded maps that do not conform.<a href="#section-2.3-5.1" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
<div id="duplicate-map-keys">
<section id="section-2.4">
        <h3 id="name-duplicate-map-keys">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-duplicate-map-keys" class="section-name selfRef">Duplicate Map Keys</a>
        </h3>
<p id="section-2.4-1">CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> defines maps with duplicate keys as invalid, but leaves how to handle such cases to the implementor (§2.2, §3.1, §5.4, §5.6).<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">dCBOR encoders:<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.4-3">
<li id="section-2.4-3.1">
            <span class="bcp14">MUST NOT</span> emit CBOR maps that contain duplicate keys.<a href="#section-2.4-3.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.4-4">dCBOR decoders:<a href="#section-2.4-4" class="pilcrow">¶</a></p>
<ol start="2" type="1" class="normal type-1" id="section-2.4-5">
<li id="section-2.4-5.1">
            <span class="bcp14">MUST</span> reject encoded maps with duplicate keys.<a href="#section-2.4-5.1" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
<div id="numeric-reduction">
<section id="section-2.5">
        <h3 id="name-numeric-reduction">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-numeric-reduction" class="section-name selfRef">Numeric Reduction</a>
        </h3>
<p id="section-2.5-1">The purpose of determinism is to ensure that semantically equivalent data items are encoded into identical byte streams. Numeric reduction ensures that semantically equal numeric values (e.g. <code>2</code> and <code>2.0</code>) are encoded into identical byte streams (e.g. <code>0x02</code>) by encoding "Integral floating point values" (floating point values with a zero fractional part) as integers when possible.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.5-2">dCBOR implementations that support floating point numbers:<a href="#section-2.5-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.5-3">
<li id="section-2.5-3.1">
            <p id="section-2.5-3.1.1"><span class="bcp14">MUST</span> check whether floating point values to be encoded have the numerically equal value in <code>DCBOR_INT</code> = [-2<sup>63</sup>, 2<sup>64</sup>-1]. If that is the case, it <span class="bcp14">MUST</span> be converted to that numerically equal integer value before encoding it. (Preferred encoding will then ensure the shortest length encoding is used.) If a floating point value has a non-zero fractional part, or an exponent that takes it out of <code>DCBOR_INT</code>, the original floating point value is used for encoding. (Specifically, conversion to a CBOR bignum is never considered.)<a href="#section-2.5-3.1.1" class="pilcrow">¶</a></p>
<p id="section-2.5-3.1.2">
This also means that the three representations of a zero number in CBOR (<code>0</code>, <code>0.0</code>, <code>-0.0</code> in diagnostic notation) are all reduced to the basic integer <code>0</code> (with preferred encoding <code>0x00</code>).<a href="#section-2.5-3.1.2" class="pilcrow">¶</a></p>
</li>
        </ol>
<aside id="section-2.5-4">
          <p id="section-2.5-4.1">Note that numeric reduction means that some maps that are valid CBOR cannot be reduced to valid dCBOR maps, as numeric reduction can result in multiple entries with the same keys ("duplicate keys"). For example, the following is a valid CBOR map:<a href="#section-2.5-4.1" class="pilcrow">¶</a></p>
<span id="name-valid-cbor-data-item-with-n"></span><figure id="figure-1">
            <div class="lang-cbor-diag sourcecode" id="section-2.5-4.2.1">
<pre>
{
   10: "ten",
   10.0: "floating ten"
}
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-valid-cbor-data-item-with-n" class="selfRef">Valid CBOR data item with numeric map keys</a>
            </figcaption></figure>
<p id="section-2.5-4.3">Applying numeric reduction to this map would yield the invalid map:<a href="#section-2.5-4.3" class="pilcrow">¶</a></p>
<span id="name-numeric-reduction-turns-val"></span><figure id="figure-2">
            <div class="lang-cbor-diag sourcecode" id="section-2.5-4.4.1">
<pre>
{  / invalid: multiple entries with the same key /
   10: "ten",
   10: "floating ten"
}
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-numeric-reduction-turns-val" class="selfRef">Numeric reduction turns valid CBOR invalid</a>
            </figcaption></figure>
<p id="section-2.5-4.5">In general, dCBOR applications need to avoid maps that have entries with keys that are semantically equivalent in dCBOR's numeric model.<a href="#section-2.5-4.5" class="pilcrow">¶</a></p>
</aside>
<ol start="2" type="1" class="normal type-1" id="section-2.5-5">
<li id="section-2.5-5.1">
            <span class="bcp14">MUST</span> reduce all encoded NaN values to the quiet NaN value having the half-width CBOR representation <code>0xf97e00</code>.<a href="#section-2.5-5.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.5-6">dCBOR decoders that support floating point numbers:<a href="#section-2.5-6" class="pilcrow">¶</a></p>
<ol start="3" type="1" class="normal type-1" id="section-2.5-7">
<li id="section-2.5-7.1">
            <span class="bcp14">MUST</span> reject any encoded floating point values that are not encoded according to the above rules.<a href="#section-2.5-7.1" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
<div id="simple-values">
<section id="section-2.6">
        <h3 id="name-simple-values">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-simple-values" class="section-name selfRef">Simple Values</a>
        </h3>
<p id="section-2.6-1">Only the three "simple" (major type 7) values <code>false</code> (0xf4), <code>true</code> (0xf5), and <code>null</code> (0xf6) and the floating point values are valid in dCBOR.<a href="#section-2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.6-2">dCBOR encoders:<a href="#section-2.6-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.6-3">
<li id="section-2.6-3.1">
            <span class="bcp14">MUST NOT</span> encode major type 7 values other than <code>false</code>, <code>true</code>, <code>null</code>, and the floating point values.<a href="#section-2.6-3.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.6-4">dCBOR decoders:<a href="#section-2.6-4" class="pilcrow">¶</a></p>
<ol start="2" type="1" class="normal type-1" id="section-2.6-5">
<li id="section-2.6-5.1">
            <span class="bcp14">MUST</span> reject any encoded major type 7 values other than <code>false</code>, <code>true</code>, <code>null</code>, and the floating point values.<a href="#section-2.6-5.1" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
<div id="strings">
<section id="section-2.7">
        <h3 id="name-strings">
<a href="#section-2.7" class="section-number selfRef">2.7. </a><a href="#name-strings" class="section-name selfRef">Strings</a>
        </h3>
<p id="section-2.7-1">CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> allows text strings to be any valid UTF-8 string (§3.1). However, Unicode character sequences can represent the same text string in different ways, leading to variability in the encoding of semantically equivalent data items. Unicode Normalization Form C (NFC) <span>[<a href="#UNICODE-NORM" class="cite xref">UNICODE-NORM</a>]</span> is a commonly used normalization form that eliminates such variability.<a href="#section-2.7-1" class="pilcrow">¶</a></p>
<p id="section-2.7-2">dCBOR encoders:<a href="#section-2.7-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.7-3">
<li id="section-2.7-3.1">
            <span class="bcp14">MUST</span> only emit text strings that are in NFC.<a href="#section-2.7-3.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.7-4">dCBOR decoders:<a href="#section-2.7-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.7-5">
<li id="section-2.7-5.1">
            <span class="bcp14">MUST</span> reject any encoded text strings that are not in NFC.<a href="#section-2.7-5.1" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="cddl-support-declarative-tag">
<section id="section-3">
      <h2 id="name-cddl-support-declarative-ta">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-cddl-support-declarative-ta" class="section-name selfRef">CDDL support, Declarative Tag</a>
      </h2>
<p id="section-3-1">CDDL <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> is a widely used language for specifying CBOR data models. This specification adds two CDDL control operators that can be used to specify that the data items should be encoded in dCBOR.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">The control operators <code>.dcbor</code> and <code>.dcborseq</code> are exactly like <code>.cbor</code> and <code>.cborseq</code> as defined in <span>[<a href="#RFC8610" class="cite xref">RFC8610</a>]</span> except that they also require the encoded data item(s) to conform to dCBOR.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">Tag 201 (<a href="#tag201" class="auto internal xref">Section 6</a>) is defined in this specification as a way to declare its tag content to conform to dCBOR at the data model level and the encoded data item level. (In conjunction with these semantics, tag 201 may also be employed as a boundary marker leading from an overall structure to specific application data items; see <span><a href="https://datatracker.ietf.org/doc/html/draft-mcnally-envelope-10#section-3" class="relref">Section 3</a> of [<a href="#GordianEnvelope" class="cite xref">GordianEnvelope</a>]</span> for an example for this usage.)<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-status">
<section id="section-4">
      <h2 id="name-implementation-status">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-implementation-status" class="section-name selfRef">Implementation Status</a>
      </h2>
<p id="section-4-1">This section is to be removed before publishing as an RFC.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">(Boilerplate as per <span><a href="https://rfc-editor.org/rfc/rfc7942#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC7942" class="cite xref">RFC7942</a>]</span>:)<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">This section records the status of known implementations of the
protocol defined by this specification at the time of posting of
this Internet-Draft, and is based on a proposal described in
<span>[<a href="#RFC7942" class="cite xref">RFC7942</a>]</span>.  The description of implementations in this section is
intended to assist the IETF in its decision processes in
progressing drafts to RFCs.  Please note that the listing of any
individual implementation here does not imply endorsement by the
IETF.  Furthermore, no effort has been spent to verify the
information presented here that was supplied by IETF contributors.
This is not intended as, and must not be construed to be, a
catalog of available implementations or their features.  Readers
are advised to note that other implementations may exist.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">According to <span>[<a href="#RFC7942" class="cite xref">RFC7942</a>]</span>, "this will allow reviewers and working
groups to assign due consideration to documents that have the
benefit of running code, which may serve as evidence of valuable
experimentation and feedback that have made the implemented
protocols more mature.  It is up to the individual working groups
to use this information as they see fit".<a href="#section-4-4" class="pilcrow">¶</a></p>
<div id="swift">
<section id="section-4.1">
        <h3 id="name-swift">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-swift" class="section-name selfRef">Swift</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-4.1-1.1">Description: Single-purpose dCBOR reference implementation for Swift.<a href="#section-4.1-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-1.2">Organization: Blockchain Commons<a href="#section-4.1-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-1.3">Implementation Location: <span>[<a href="#BCSwiftDCBOR" class="cite xref">BCSwiftDCBOR</a>]</span><a href="#section-4.1-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-1.4">Primary Maintainer: Wolf McNally<a href="#section-4.1-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-1.5">Languages: Swift<a href="#section-4.1-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-1.6">Coverage: Complete<a href="#section-4.1-1.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-1.7">Testing: Unit tests<a href="#section-4.1-1.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-1.8">Licensing: BSD-2-Clause-Patent<a href="#section-4.1-1.8" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="rust">
<section id="section-4.2">
        <h3 id="name-rust">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-rust" class="section-name selfRef">Rust</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-4.2-1.1">Description: Single-purpose dCBOR reference implementation for Rust.<a href="#section-4.2-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-1.2">Organization: Blockchain Commons<a href="#section-4.2-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-1.3">Implementation Location: <span>[<a href="#BCRustDCBOR" class="cite xref">BCRustDCBOR</a>]</span><a href="#section-4.2-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-1.4">Primary Maintainer: Wolf McNally<a href="#section-4.2-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-1.5">Languages: Rust<a href="#section-4.2-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-1.6">Coverage: Complete<a href="#section-4.2-1.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-1.7">Testing: Unit tests<a href="#section-4.2-1.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-1.8">Licensing: BSD-2-Clause-Patent<a href="#section-4.2-1.8" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="typescript">
<section id="section-4.3">
        <h3 id="name-typescript">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-typescript" class="section-name selfRef">TypeScript</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-4.3-1.1">Description: Single-purpose dCBOR reference implementation for TypeScript.<a href="#section-4.3-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-1.2">Organization: Blockchain Commons<a href="#section-4.3-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-1.3">Implementation Location: <span>[<a href="#BCTypescriptDCBOR" class="cite xref">BCTypescriptDCBOR</a>]</span><a href="#section-4.3-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-1.4">Primary Maintainer: Wolf McNally<a href="#section-4.3-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-1.5">Languages: TypeScript (transpiles to JavaScript)<a href="#section-4.3-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-1.6">Coverage: Complete<a href="#section-4.3-1.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-1.7">Testing: Unit tests<a href="#section-4.3-1.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-1.8">Licensing: BSD-2-Clause-Patent<a href="#section-4.3-1.8" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="ruby">
<section id="section-4.4">
        <h3 id="name-ruby">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-ruby" class="section-name selfRef">Ruby</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-4.4-1.1">Implementation Location: <span>[<a href="#cbor-dcbor" class="cite xref">cbor-dcbor</a>]</span><a href="#section-4.4-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-1.2">Primary Maintainer: Carsten Bormann<a href="#section-4.4-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-1.3">Languages: Ruby<a href="#section-4.4-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-1.4">Coverage: Complete specification; complemented by CBOR encoder/decoder and command line interface from <span>[<a href="#cbor-diag" class="cite xref">cbor-diag</a>]</span> and deterministic encoding from <span>[<a href="#cbor-deterministic" class="cite xref">cbor-deterministic</a>]</span>. Checking of dCBOR - exclusions not yet implemented.<a href="#section-4.4-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-1.5">Testing: Also available at https://cbor.me<a href="#section-4.4-1.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-1.6">Licensing: Apache-2.0<a href="#section-4.4-1.6" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">This document inherits the security considerations of CBOR <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span>.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Vulnerabilities regarding dCBOR will revolve around whether an attacker can find value in producing semantically equivalent documents that are nonetheless serialized into non-identical byte streams. Such documents could be used to contain malicious payloads or exfiltrate sensitive data. The ability to create such documents could indicate the failure of a dCBOR decoder to correctly validate according to this document, or the failure of the developer to properly specify or implement application protocol requirements using dCBOR. Whether these possibilities present an identifiable attack surface is a question that developers should consider.<a href="#section-5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tag201">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">RFC Editor: please replace RFCXXXX with the RFC number of this RFC and remove this note.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">IANA has registered the following CBOR tag in the "CBOR Tags" registry of <span>[<a href="#IANACBORTAGS" class="cite xref">IANACBORTAGS</a>]</span>:<a href="#section-6-2" class="pilcrow">¶</a></p>
<span id="name-cbor-tag-for-dcbor"></span><table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-cbor-tag-for-dcbor" class="selfRef">CBOR Tag for dCBOR</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Tag</th>
            <th class="text-left" rowspan="1" colspan="1">Data Item</th>
            <th class="text-left" rowspan="1" colspan="1">Semantics</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">#201</td>
            <td class="text-left" rowspan="1" colspan="1">(any)</td>
            <td class="text-left" rowspan="1" colspan="1">enclosed dCBOR</td>
            <td class="text-left" rowspan="1" colspan="1">[RFCXXXX]</td>
          </tr>
        </tbody>
      </table>
<p id="section-6-4">This document requests IANA to register the contents of Table 1 into the registry "CDDL Control Operators" of <span>[<a href="#IANACDDL" class="cite xref">IANACDDL</a>]</span>:<a href="#section-6-4" class="pilcrow">¶</a></p>
<span id="name-cddl-control-operators-for-"></span><table class="center" id="table-2">
        <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-cddl-control-operators-for-" class="selfRef">CDDL Control Operators for dCBOR</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Reference</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">.dcbor</td>
            <td class="text-left" rowspan="1" colspan="1">[RFCXXXX]</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">.dcborseq</td>
            <td class="text-left" rowspan="1" colspan="1">[RFCXXXX]</td>
          </tr>
        </tbody>
      </table>
</section>
</div>
<div id="appendix-a-dcbor-numeric-test-vectors">
<section id="section-7">
      <h2 id="name-appendix-a-dcbor-numeric-te">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-appendix-a-dcbor-numeric-te" class="section-name selfRef">Appendix A: dCBOR Numeric Test Vectors</a>
      </h2>
<p id="section-7-1">The following tables provide common and edge-case numeric test vectors for dCBOR encoders and decoders, and are intended to exercise the requirements of this specification.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="dcbor-numeric-encodings">
<section id="section-7.1">
        <h3 id="name-dcbor-numeric-encodings">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-dcbor-numeric-encodings" class="section-name selfRef">dCBOR Numeric Encodings</a>
        </h3>
<table class="center" id="table-3">
          <caption><a href="#table-3" class="selfRef">Table 3</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">dCBOR Encoding</th>
              <th class="text-left" rowspan="1" colspan="1">Note</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>00</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>01</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">23</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>17</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">24</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>1818</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">255 (2<sup>8</sup> - 1)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>18ff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">65535 (2<sup>16</sup> - 1)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>19ffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">65536 (2<sup>16</sup>)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>1a00010000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">4294967295 (2<sup>32</sup> - 1)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>1affffffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">4294967296 (2<sup>32</sup>)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>1b0000000100000000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">18446744073709551615 (2<sup>64</sup> - 1)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>1bffffffffffffffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-1</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>20</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-2</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>21</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-127 (-2<sup>8</sup> - 1)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>387e</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-128 (-2<sup>7</sup>)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>387f</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-32768 (-2<sup>16</sup>)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>397fff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-2147483648 (-2<sup>31</sup>)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>3a7fffffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-9223372036854775808  (-2<sup>63</sup>)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>3b7fffffffffffffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1.5</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>f93e00</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2345678.25</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fa4a0f2b39</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1.2</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fb3ff3333333333333</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"> </td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">42.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>182a</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Reduced.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2345678.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>1a0023cace</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Reduced.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-2345678.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>3a0023cacd</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Reduced.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-0.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>00</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Reduced.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">5.960464477539063e-08</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>f90001</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Smallest half-precision subnormal.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1.401298464324817e-45</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fa00000001</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Smallest single subnormal.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">5e-324</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fb0000000000000001</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Smallest double subnormal.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2.2250738585072014e-308</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fb0010000000000000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Smallest double normal.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">6.103515625e-05</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>f90400</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Smallest half-precision normal.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">65504.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>19ffe0</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Reduced. Largest possible half-precision.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">33554430.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>1a01fffffe</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Reduced. Exponent 24 to test single exponent boundary.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-9223372036854774784.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>3b7ffffffffffffbff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Reduced. Most negative double that converts to int64.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">18446744073709550000.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>1bfffffffffffff800</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Reduced. Largest double that can convert to uint64, almost UINT64_MAX.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">18446744073709552000.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fa5f800000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Just too large to convert to uint64, but converts to a single, just over UINT64_MAX.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-18446742974197924000.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fadf7fffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Large negative that converts to float, but too large for int64.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">3.4028234663852886e+38</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fa7f7fffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Largest possible single.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">3.402823466385289e+38</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fb47efffffe0000001</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Slightly larger than largest possible single.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1.7976931348623157e+308</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fb7fefffffffffffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Largest double.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Infinity (any size)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>f97c00</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Canonicalized.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-Infinity (any size)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>f9fc00</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Canonicalized.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NaN (any size, any payload)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>f97e00</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Canonicalized.</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
<div id="invalid-dcbor-encodings">
<section id="section-7.2">
        <h3 id="name-invalid-dcbor-encodings">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-invalid-dcbor-encodings" class="section-name selfRef">Invalid dCBOR Encodings</a>
        </h3>
<p id="section-7.2-1">These are valid CBOR encodings that <span class="bcp14">MUST</span> be rejected as invalid by a dCBOR-compliant decoder.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<table class="center" id="table-4">
          <caption><a href="#table-4" class="selfRef">Table 4</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">CBOR Encoding</th>
              <th class="text-left" rowspan="1" colspan="1">Reason for Rejection</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">12.0</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>f94a00</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Can be reduced to 12.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1.5</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fb3ff8000000000000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Not preferred encoding.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-9223372036854775809 (-2<sup>63</sup> - 1)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>3b8000000000000000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">65-bit negative integer value.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-18446744073709551616 (-2<sup>64</sup>)</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>3bffffffffffffffff</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">65-bit negative integer value.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Infinity</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fb7ff0000000000000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Not preferred encoding.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Infinity</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fa7f800000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Not preferred encoding.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-Infinity</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fbfff0000000000000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Not preferred encoding.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">-Infinity</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>faff800000</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Not preferred encoding.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NaN</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>fb7ff9100000000001</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Not canonical NaN.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NaN</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>faffc00001</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Not canonical NaN.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">NaN</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>f97e01</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Not canonical NaN.</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
</section>
</div>
<div id="appendix-b-design-principles">
<section id="section-8">
      <h2 id="name-appendix-b-design-principle">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-appendix-b-design-principle" class="section-name selfRef">Appendix B: Design Principles</a>
      </h2>
<p id="section-8-1">dCBOR has a single overriding goal: to facilitate <em>determinism</em>.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">This means to ensure or facilitate, as much as possible, that semantically equivalent data items are encoded as identical byte streams.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">In general, this means reducing or eliminating <em>variability</em> in the encoding of data items. Variability arises where more than one valid encoding is possible for a given data item, and a protocol designer must make a choice as to which encoding to use. These choices can be arbitrary, and different protocol designers may make different arbitrary, and equally valid choices.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">One of the most common examples of this arises with typed numeric values, where a numeric field must be pre-assigned a type (e.g., signed or unsigned integer of 8, 16, 32, or 64 bits, floating point of 16, 32, or 64 bits, etc.) CBOR's basic numeric data model is typed, and requires that numeric values be encoded according to their type. This is a cognitive burden on protocol designers, and a source of variability, since there may be several ways to encode a given numeric value depending on the type assigned to it. Many developers would prefer to encode numeric values without worrying about types, and let the encoding format handle the details, including ensuring deterministic encoding.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">While dCBOR cannot automatically eliminate all variability in the design of deterministic protocols, it can provide a set of narrowing rules within its scope and level of abstraction that reduce the number of choices that protocol designers need to make.<a href="#section-8-5" class="pilcrow">¶</a></p>
<p id="section-8-6">dCBOR makes no claim that these are the <em>only</em> or <em>best</em> possible narrowing rules for deterministic encoding for every application. But dCBOR does provide a set of well-defined, easy-to-understand, and easy-to-implement rules that can be deployed as a package to facilitate deterministic encoding for a wide variety of applications. Making these choices at the dCBOR level reduces cognitive burden for protocol designers, and decreases the risk of interoperability problems between different implementations.<a href="#section-8-6" class="pilcrow">¶</a></p>
<table class="center" id="table-5">
        <caption><a href="#table-5" class="selfRef">Table 5</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Variability Source</th>
            <th class="text-left" rowspan="1" colspan="1">dCBOR Rule</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Indefinite or definite length items</td>
            <td class="text-left" rowspan="1" colspan="1">Only definite Length Items</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Multiple possible encodings for same data item</td>
            <td class="text-left" rowspan="1" colspan="1">Only preferred serialization</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Different orders for map keys</td>
            <td class="text-left" rowspan="1" colspan="1">Only ordered map Keys</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Duplicate map keys</td>
            <td class="text-left" rowspan="1" colspan="1">Duplicate Map Keys disallowed</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Semantically equivalent numeric values (e.g., 0, 0.0, -0.0)</td>
            <td class="text-left" rowspan="1" colspan="1">Only a single encoding for each distinct value</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Choice of <code>null</code> or <code>undefined</code>
</td>
            <td class="text-left" rowspan="1" colspan="1">Only <code>null</code>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Simple values other than <code>false</code>, <code>true</code>, <code>null</code>
</td>
            <td class="text-left" rowspan="1" colspan="1">Only <code>false</code>, <code>true</code>, <code>null</code>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Nontrivial <code>NaN</code>s (sign, signaling, payloads)</td>
            <td class="text-left" rowspan="1" colspan="1">Single <code>NaN</code>
</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Equivalent strings with multiple Unicode representations</td>
            <td class="text-left" rowspan="1" colspan="1">Only NFC text strings</td>
          </tr>
        </tbody>
      </table>
<p id="section-8-8">The sections below explain the rationale for some of these choices.<a href="#section-8-8" class="pilcrow">¶</a></p>
<div id="why-numeric-reduction">
<section id="section-8.1">
        <h3 id="name-why-numeric-reduction">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-why-numeric-reduction" class="section-name selfRef">Why Numeric Reduction?</a>
        </h3>
<p id="section-8.1-1">The numeric model of <span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> provides three kinds of basic numeric types: unsigned integers (Major Type 0), negative integers (Major Type 1), and floating point numbers (Shares major Type 7 with Simple Values). Not all applications require floating point values, and those that do not are unaffected by the presence of floating point numbers in the CBOR model. However, the RFC introduces the possibility of variability in certain places. For example, §3.4.2 defines Tag 1 as "Epoch-Based Date/Time":<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-8.1-2.1">
            <p id="section-8.1-2.1.1">Tag number 1 contains a numerical value counting the number of seconds from 1970-01-01T00:00Z in UTC time to the represented point in civil time.<a href="#section-8.1-2.1.1" class="pilcrow">¶</a></p>
<p id="section-8.1-2.1.2">The tag content <span class="bcp14">MUST</span> be an unsigned or negative integer (major types 0 and 1) or a floating-point number (major type 7 with additional information 25, 26, or 27). Other contained types are invalid.<a href="#section-8.1-2.1.2" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-8.1-3">An inhabitant of Tag 1, as long as it represents an integral number of seconds since the epoch, could therefore be encoded as an integer <em>or</em> a floating point number. dCBOR's numeric reduction rule ensures that such values are always encoded as integers, eliminating variability in the encoding of such values.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">But this raises a larger policy question for determinism: If two numeric values are semantically equal, should they be encoded identically? dCBOR answers "yes" to this question, and numeric reduction is the mechanism by which this is achieved. This choice answers the determinism question in a way that is simple to understand and implement, and that works well for the vast majority of applications. The serialization is still typed, but the burden of choosing types is reduced for protocol designers, who can simply specify numeric fields without worrying about the details of how those numbers will be encoded.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="why-not-undefined">
<section id="section-8.2">
        <h3 id="name-why-not-undefined">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-why-not-undefined" class="section-name selfRef">Why Not <code>undefined</code>?</a>
        </h3>
<p id="section-8.2-1">How to represent an absent value is a perennial question in data modeling. In general it is useful to have a value that represents a placeholder for a position where a value <em>could</em> be present but is not. This could be used in a map to indicate that a key is bound but has no value, or in an array to indicate that a value at a particular index is absent. There are other sorts of absence as well, such as the absence of a key in a map. dCBOR cannot address all of these different notions of absence, but can and does address the lack of semantic clarity around the choice between <code>null</code> and <code>undefined</code> by choosing <code>null</code> as the sole representation of a placeholder for an absent value. <code>null</code> is widely used in data modeling, and has a clear and unambiguous meaning. In contrast, <code>undefined</code> is less commonly used, and its meaning can be ambiguous. By choosing <code>null</code>, dCBOR provides a single clear way to represent absent values, reducing variability.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="why-only-a-single-nan">
<section id="section-8.3">
        <h3 id="name-why-only-a-single-nan">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-why-only-a-single-nan" class="section-name selfRef">Why only a single <code>NaN</code>?</a>
        </h3>
<p id="section-8.3-1">How to represent the result of a computation like <code>1.0 / 0.0</code> is another perennial question in data modeling. The <span>[<a href="#IEEE754" class="cite xref">IEEE754</a>]</span> floating point standard answers this question with the concept of "Not a Number" (<code>NaN</code>): a special value that represents an unrepresentable or undefined numerical result. However, the standard also specifies several bit fields within the <code>NaN</code> representation that can vary, including the sign bit, whether the <code>NaN</code> is "quiet" or "signaling", and a payload field. These formations are useful in certain computational contexts, but have no general meaning in data modeling.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">The problem of <code>NaN</code> is complicated by the fact that IEEE 754 specifies that all <code>NaN</code> values compare as "not equal" to all other numeric values, including themselves. This means that comparing any two <code>NaN</code> values, including identical ones, will always yield "not equal". The deeper problem this raises is that if you want to know what data a <code>NaN</code> might carry in its payload, you have to go to extraordinary lengths to extract that information, since you cannot simply compare two <code>NaN</code> values to determine whether they are the same.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">This not only raises deterministic variability issues (the array <code>[1, NaN, 3]</code> could be encoded in multiple ways depending on the <code>NaN</code> representation used), but also security issues as an attacker could use different <code>NaN</code> representations to exfiltrate data or hide malicious payloads, knowing that any comparison of <code>NaN</code> values will fail.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<p id="section-8.3-4">Given that <code>NaN</code> has utility in general data modeling, but its specification complexities raise both determinism and security issues, dCBOR chooses to simplify the situation by requiring that all <code>NaN</code> values be encoded as the single quiet <code>NaN</code> value having the half-width CBOR representation <code>0xf97e00</code>.<a href="#section-8.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="why-not-other-simple-values">
<section id="section-8.4">
        <h3 id="name-why-not-other-simple-values">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-why-not-other-simple-values" class="section-name selfRef">Why not other simple values?</a>
        </h3>
<p id="section-8.4-1"><span>[<a href="#RFC8949" class="cite xref">RFC8949</a>]</span> Major Type 7 defines a space of 256 code points for "simple values", and §3.3 defines four simple values and assigns them code points in the Major Type 7 space: <code>false</code> (20), <code>true</code> (21), <code>null</code> (22), and <code>undefined</code> (23). We have already discussed the choice of <code>null</code> over <code>undefined</code>. However, the remaining code points in this space are listed as either "unassigned" or "reserved" and delegates the registry of simple values to the IANA CBOR Simple Tags Registry <span>[<a href="#IANASIMPLEVALUES" class="cite xref">IANASIMPLEVALUES</a>]</span>, which lists no assigned values other than those four.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">The implication of this is that the semantics of these other simple values are officially undefined, and they cannot simply be used as application-defined values without risking interoperability issues. dCBOR therefore chooses to limit use of simple values to the three well-defined values <code>false</code>, <code>true</code>, and <code>null</code>, which are widely used in data modeling and have clear and unambiguous meanings.<a href="#section-8.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="limiting-principles">
<section id="section-8.5">
        <h3 id="name-limiting-principles">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-limiting-principles" class="section-name selfRef">Limiting Principles</a>
        </h3>
<p id="section-8.5-1">A limiting principle of dCBOR is that it concerns itself with the most common data items used in CBOR applications. As a result, dCBOR does not place requirements on the encoding or decoding of CBOR data items that are less commonly used in practice, such as bignums, complex numbers, or other tagged data items. dCBOR implementations are not required to support these data items, but if they do, they must support them within the rules of dCBOR.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<p id="section-8.5-2">Tags provide a useful "escape hatch" for applications that need to use data items not covered by dCBOR. For example, dCBOR applications can freely use Tag 2 or Tag 3 to encode bignums, which contain byte strings, and on which dCBOR places no restrictions beyond those that apply to all byte strings (definite length only). Similarly, the rare applications that need to convey nontrivial <code>NaN</code> values can use Tag 80, 81, or 82 as defined in the IANA CBOR Tags Registery <span>[<a href="#IANACBORTAGS" class="cite xref">IANACBORTAGS</a>]</span>. These tags use byte strings to encode arrays of fixed-length IEEE 754 floating point values in big-endian byte order.<a href="#section-8.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="why-not-define-an-api">
<section id="section-8.6">
        <h3 id="name-why-not-define-an-api">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-why-not-define-an-api" class="section-name selfRef">Why not define an API?</a>
        </h3>
<p id="section-8.6-1">Because dCBOR mandates strictness in both encoding and decoding, and because of mechanisms it introduces such as numeric reduction, the question arises as to whether this document should specify an API, or at least a set of best practices, for dCBOR codec APIs. The authors acknowledge that such guidance might be useful, but since the purpose of dCBOR is to provide a deterministic encoding format, and because APIs can vary widely between programming languages and environments, the authors have chosen to not widen the scope of this document. We direct the reader to the several existing dCBOR implementations for guidance on API design.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="IANACBORTAGS">[IANACBORTAGS]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR) Tags"</span>, <span>&lt;<a href="https://www.iana.org/assignments/cbor-tags">https://www.iana.org/assignments/cbor-tags</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANACDDL">[IANACDDL]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Concise Data Definition Language (CDDL)"</span>, <span>&lt;<a href="https://www.iana.org/assignments/cddl">https://www.iana.org/assignments/cddl</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANASIMPLEVALUES">[IANASIMPLEVALUES]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR) Simple Values"</span>, <span>&lt;<a href="https://www.iana.org/assignments/cbor-simple-values">https://www.iana.org/assignments/cbor-simple-values</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE754">[IEEE754]</dt>
        <dd>
<span class="refTitle">"IEEE Standard for Floating-Point Arithmetic"</span>, <span>n.d.</span>, <span>&lt;<a href="https://ieeexplore.ieee.org/document/8766229">https://ieeexplore.ieee.org/document/8766229</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8610">https://www.rfc-editor.org/rfc/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8949">https://www.rfc-editor.org/rfc/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="UNICODE-NORM">[UNICODE-NORM]</dt>
      <dd>
<span class="refTitle">"Unicode Normalization Forms"</span>, <span>n.d.</span>, <span>&lt;<a href="https://unicode.org/reports/tr15/">https://unicode.org/reports/tr15/</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BCRustDCBOR">[BCRustDCBOR]</dt>
        <dd>
<span class="refAuthor">McNally, W.</span>, <span class="refTitle">"Deterministic CBOR (dCBOR) for Rust."</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/BlockchainCommons/bc-dcbor-rust">https://github.com/BlockchainCommons/bc-dcbor-rust</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BCSwiftDCBOR">[BCSwiftDCBOR]</dt>
        <dd>
<span class="refAuthor">McNally, W.</span>, <span class="refTitle">"Deterministic CBOR (dCBOR) for Swift."</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/BlockchainCommons/BCSwiftDCBOR">https://github.com/BlockchainCommons/BCSwiftDCBOR</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BCTypescriptDCBOR">[BCTypescriptDCBOR]</dt>
        <dd>
<span class="refAuthor">McNally, W.</span>, <span class="refTitle">"Deterministic CBOR (dCBOR) for Typescript."</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/BlockchainCommons/bc-dcbor-ts">https://github.com/BlockchainCommons/bc-dcbor-ts</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="cbor-dcbor">[cbor-dcbor]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"PoC of the McNally/Allen dCBOR application-level CBOR representation rules"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/cabo/cbor-dcbor">https://github.com/cabo/cbor-dcbor</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="cbor-deterministic">[cbor-deterministic]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"cbor-deterministic gem"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/cabo/cbor-deterministic">https://github.com/cabo/cbor-deterministic</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="cbor-diag">[cbor-diag]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"CBOR diagnostic utilities"</span>, <span>n.d.</span>, <span>&lt;<a href="https://github.com/cabo/cbor-diag">https://github.com/cabo/cbor-diag</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="GordianEnvelope">[GordianEnvelope]</dt>
        <dd>
<span class="refAuthor">McNally, W.</span> and <span class="refAuthor">C. Allen</span>, <span class="refTitle">"The Gordian Envelope Structured Data Format"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-mcnally-envelope-10</span>, <time datetime="2025-09-30" class="refDate">30 September 2025</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-mcnally-envelope-10">https://datatracker.ietf.org/doc/html/draft-mcnally-envelope-10</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7942">[RFC7942]</dt>
      <dd>
<span class="refAuthor">Sheffer, Y.</span> and <span class="refAuthor">A. Farrel</span>, <span class="refTitle">"Improving Awareness of Running Code: The Implementation Status Section"</span>, <span class="seriesInfo">BCP 205</span>, <span class="seriesInfo">RFC 7942</span>, <span class="seriesInfo">DOI 10.17487/RFC7942</span>, <time datetime="2016-07" class="refDate">July 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7942">https://www.rfc-editor.org/rfc/rfc7942</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="acknowledgments">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">The authors are grateful for the contributions of Joe Hildebrand, Rohan Mahy, and Anders Rundgren in the CBOR working group.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Wolf McNally</span></div>
<div dir="auto" class="left"><span class="org">Blockchain Commons</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:wolf@wolfmcnally.com" class="email">wolf@wolfmcnally.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher Allen</span></div>
<div dir="auto" class="left"><span class="org">Blockchain Commons</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:christophera@lifewithalacrity.com" class="email">christophera@lifewithalacrity.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Carsten Bormann</span></div>
<div dir="auto" class="left"><span class="org">Universität Bremen TZI</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cabo@tzi.org" class="email">cabo@tzi.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Laurence Lundblade</span></div>
<div dir="auto" class="left"><span class="org">Security Theory LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:lgl@securitytheory.com" class="email">lgl@securitytheory.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
